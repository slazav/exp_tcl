#!/usr/bin/tclsh

# general cmdline interface for device library

package require Device 1.5
package require ParseOptions 2.0

#############################################################
## Command line options:
set options [list \
{-d -dev}      dev   {}  {device}\
{-l -lock}     lock  0   {lock the device}\
]

#############################################################

itcl::class DeviceController {

  variable dev
  variable lock

  constructor {opts} {
    #Parse options.
    global options
    parse_options "device" $opts $options

    if {$dev  == {} } { error "Use -dev option to specify the device" }
    Device $dev
    if { $lock } {$dev lock}
  }

  destructor {
    if { $lock } {$dev unlock}
    itcl::delete object $dev
  }

  ######################################

  # set current for both channels (internal)
  method cmd {args} {
    set ret [$dev cmd {*}$args]
    foreach line $ret { spp_server::answer $line }
  }
}

set spp_server::int_type 1
spp_server::run DeviceController $argv
